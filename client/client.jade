head
    title RH App
    meta(name='viewport', content='user-scalable=no, initial-scale=1.0, maximum-scale=1.0, width=device-width')
    meta(name='apple-mobile-web-app-capable', content='yes')
    meta(name='apple-mobile-web-app-status-bar-style', content='black')
    meta(name="msapplication-TileColor" content="#000000")
    meta(name="theme-color" content="#000000")
    link(rel='stylesheet' type='text/css' href='https://cdn.jsdelivr.net/npm/fomantic-ui@2.7.4/dist/semantic.min.css')
    // link(href="https://fonts.googleapis.com/css?family=Ubuntu:300,400&display=swap" rel="stylesheet")
    link(rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png")
    link(rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png")
    link(rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png")
    link(rel="manifest" href="/site.webmanifest")
    link(rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000")
    // link(href="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/css/suneditor.min.css" rel="stylesheet")

    script(src='https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js')
    script(src='https://cdn.jsdelivr.net/npm/fomantic-ui@2.7.4/dist/semantic.min.js')
    
    // script(src="https://cdn.jsdelivr.net/npm/sweetalert2@9")
    // script(src="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/suneditor.min.js")
    // script(src="https://cdn.jsdelivr.net/npm/suneditor@latest/src/lang/en.js")

    //- script(async='', src='https://www.googletagmanager.com/gtag/js?id=UA-140259454-1')
    script.
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'G-GLYPPRGJFQ');

    
template(name='layout')
    // img.ui.fluid.image.checkin_banner(src="{{c.url 'frontrange' width=1000 height=1000 crop='crop'}}")
    +nav
    if logging_in
        .ui.center.aligned.basic.segment
            i.massive.loading.food.grey.icon
    else
        .global_container.scrolling
            unless currentUser
                .ui.center.aligned.basic.segment
                    strong pick station
                    +role_picker name='middle_eastern' icon='israel'
                    +role_picker name='mexican' icon='kawaii-taco'
                    +role_picker name='mediterranean' icon='greek-salad'
                    +role_picker name='chinese' icon='rice-bowl'
                    +role_picker name='italian' icon='spaghetti'
                    +role_picker name='american' icon='hamburger'
                    +role_picker name='pastry' icon='confectionery'
                    +role_picker name='porters' icon='dishwasher' 
                    +role_picker name='roof' icon='bar-building'
                    +role_picker name='lower_bar' icon='bar'
                    +role_picker name='admin' icon='shield'
                .ui.center.aligned.basic.segment
                    strong or pick user
                        each users
                            +role_picker name=username
            else
                +yield


                


template(name='role_picker')
    .ui.circular.basic.big.compact.button.pick_user
        if icon
            +i name=icon cl='ui avatar image'
        |#{name}
        
        

template(name='transfers')
    .ui.padded.stackable.grid
        .twelve.wide.column
            .ui.inline.header 
                i.exchange.icon
                |#{request_docs.count} requests
            .ui.basic.compact.circular.button new
            .ui.basic.compact.circular.button in progress
            .ui.basic.compact.circular.button delivered
            .ui.large.selection.link.animated.list.scrolling
                each request_docs
                    +request_item
        .four.wide.column
            .ui.header 
                i.line.chart.icon
                |stats
            .ui.header total requests
            .ui.header average delivery time
            .ui.header most requested items
            .ui.header requests this week
            .ui.header requests last week
            
            
template(name='requests')
    .ui.padded.stackable.grid
        // unless is currentUser.username 'porters'
        // .eight.wide.column
        //     .ui.inline.center.aligned.header 
        //         i.bullhorn.icon
        //         |#{roof_requests.count} #{currentUser.username} requests
        //     .ui.list.smallscrol
        //         each roof_requests
        //             +request_item
        .eight.wide.column
            .ui.inline.center.aligned.header 
                i.bullhorn.icon
                |#{unprocessed_requests.count} new requests
            .ui.list.smallscrol
                each unprocessed_requests
                    +request_item
        .eight.wide.column
            .ui.inline.center.aligned.header 
                i.running.icon
                |#{processed_requests.count} in progress
            .ui.list.smallscrol
                each processed_requests
                    +request_item
    unless is_porters
        +items




template(name='request_item')
    .ui.grid
        .four.wide.column
            img.ui.inline.image(src="{{c.url item_image_id width=500 height=500 gravity='face' crop='fill'}}")
        .twelve.wide.column
            .ui.inline.header
                |#{item_title} 
                i.large.chevron.right.icon
                |#{_author_username}
                // if is_requested
                //     i.bullhorn.red.icon(title='requested')
                // else if is_processing
                //     i.running.yellow.icon(title='en route')
                // else if is_delivered
                //     i.checkmark.green.icon(title='delivered')
                //     // .ui.big.label(class=request_class)
            div 
            i.grey.clock.icon
            | added #{when}
            if is_requested
                if is_porters
                    .ui.big.yellow.button.pick_up
                        i.running.icon
                        |pick up
                if is_requester
                    .ui.basic.red.circular.icon.button.cancel_request(title='cancel')
                        i.remove.icon
                        // |cancel
            else if is_processing
                div
                |picked up {{from_now pick_up_timestamp}}
                if is_roof
                    .ui.big.green.button.mark_complete
                        i.checkmark.icon
                        |mark complete
                if is_porters
                    .ui.big.green.button.mark_delivered
                        i.checkmark.icon
                        |mark delivered
                // if key_value_is _author_username currentUser.username
            else if is_delivered
                | picked up {{from_now pick_up_timestamp}}
                |, delivered {{from_now delivered_timestamp}}
                |, ({{delivery_time}} mins)                
                
                
                
template(name='items')
    .ui.padded.stackable.grid
        .sixteen.wide.column
            .ui.inline.header 
                |item request menu
                // if is_admin
                i.plus.circular.link.small.icon.add_item
            .ui.input
                input(type='text' placeholder='search title...')
        .sixteen.wide.column
            .ui.six.doubling.cards
                each unarchived_items
                    +item_item
        if is_admin
            .sixteen.wide.column
                .ui.header 
                    i.archive.icon
                    |archived items
                .ui.six.doubling.cards
                    each archived_items
                        +item_item
                div
        


template(name='item_item')
    if session_is 'editing_item' _id
        .ui.card
            +image_edit key='image_id' direct=true
            .content
                +text_edit key='title' direct=true
                i.checkmark.circular.link.green.icon.save_item   
                +boolean_edit key='archived' label='archived' icon='archive' direct=true
    else
        .ui.card
            // if unless
            img.ui.image.request_item.pointer(src="{{c.url image_id width=500 height=500 gravity='face' crop='fill'}}")
            // else
            //     img.ui.image(src="{{c.url image_id width=500 height=500 gravity='face' crop='fill'}}")
            .content
                .ui.inline.header #{title}
                // if is_roof            
                //     .ui.basic.button.request_item
                //         i.dolly.green.icon
                //         |request
                if is_admin
                    i.pencil.circular.link.icon.edit_item            
                